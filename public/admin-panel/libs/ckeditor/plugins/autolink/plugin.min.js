(function(){"use strict";var doubleQuoteRegex=/"/g;CKEDITOR.plugins.add("autolink",{requires:"clipboard,textmatch",init:function(editor){var urlTemplate=new CKEDITOR.template('<a href="{link}">{text}</a>'),emailTemplate=new CKEDITOR.template('<a href="mailto:{link}">{text}</a>');editor.on("paste",function(evt){if(evt.data.dataTransfer.getTransferType(editor)==CKEDITOR.DATA_TRANSFER_INTERNAL){return}var data=evt.data.dataValue;if(data.indexOf("<")>-1){return}if(matchLink(data)){evt.data.dataValue=getHtmlToInsert(data);evt.data.type="html"}});if(CKEDITOR.env.ie&&!CKEDITOR.env.edge){return}editor.on("key",function(evt){if(editor.mode!=="wysiwyg"||CKEDITOR.tools.indexOf(editor.config.autolink_commitKeystrokes,evt.data.keyCode)==-1){return}var matched=CKEDITOR.plugins.textMatch.match(editor.getSelection().getRanges()[0],matchCallback);if(matched){insertLink(matched)}});function insertLink(match){var selection=editor.getSelection();if(selection.getRanges()[0].startContainer.getAscendant("a",true)){return}selection.selectRanges([match.range]);editor.insertHtml(getHtmlToInsert(match.text),"text");if(!CKEDITOR.env.webkit){var insertionRange=selection.getRanges()[0],newRange=editor.createRange();newRange.setStartAfter(insertionRange.startContainer);selection.selectRanges([newRange])}}function tryToEncodeLink(data){if(editor.plugins.link){var link=CKEDITOR.dom.element.createFromHtml(data),linkData=CKEDITOR.plugins.link.parseLinkAttributes(editor,link),attributes=CKEDITOR.plugins.link.getLinkAttributes(editor,linkData);if(!CKEDITOR.tools.isEmpty(attributes.set)){link.setAttributes(attributes.set)}if(attributes.removed.length){link.removeAttributes(attributes.removed)}link.removeAttribute("data-cke-saved-href");return link.getOuterHtml()}return data}function getHtmlToInsert(text){var opts={text:text,link:text.replace(doubleQuoteRegex,"%22")},template=opts.link.match(editor.config.autolink_urlRegex)?urlTemplate.output(opts):emailTemplate.output(opts);return tryToEncodeLink(template)}function matchCallback(text,offset){var parts=text.slice(0,offset).split(/\s+/),query=parts[parts.length-1];if(!query){return null}if(!matchLink(query)){return null}return{start:text.lastIndexOf(query),end:offset}}function matchLink(query){return query.match(editor.config.autolink_urlRegex)||query.match(editor.config.autolink_emailRegex)}}});CKEDITOR.config.autolink_commitKeystrokes=[13,32];CKEDITOR.config.autolink_urlRegex=/^(https?|ftp):\/\/(-\.)?([^\s\/?\.#]+\.?)+(\/[^\s]*)?[^\s\.,]$/i;CKEDITOR.config.autolink_emailRegex=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/})();